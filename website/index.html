<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steppe - Composable, self-documenting REST APIs for Ruby</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
</head>
<body>
    <nav class="top-menu">
        <div class="top-menu-content">
            <div class="top-menu-brand">
                <span class="brand-name">Steppe</span>
                <span class="brand-tagline">Composable REST APIs for Ruby</span>
            </div>
            <a href="https://github.com/ismasan/steppe" target="_blank" class="github-link" aria-label="View on GitHub">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                <span>GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <nav class="sidebar">
            <div class="logo">
                <h2>Steppe</h2>
                <p class="tagline">REST APIs for Ruby</p>
            </div>
            <ul class="nav-menu">
                <li><a href="#usage">Usage</a></li>
                <li class="nav-submenu"><a href="#defining-a-service">Defining a service</a></li>
                <li class="nav-submenu"><a href="#defining-endpoints">Defining endpoints</a></li>
                <li class="nav-submenu"><a href="#query-schemas">Query schemas</a></li>
                <li class="nav-submenu"><a href="#payload-schemas">Payload schemas</a></li>
                <li class="nav-submenu"><a href="#its-pipelines-steps-all-the-way-down">Its pipelines steps all the way down</a></li>
                <li class="nav-submenu"><a href="#file-uploads">File Uploads</a></li>
                <li class="nav-submenu"><a href="#named-serializers">Named Serializers</a></li>
                <li class="nav-submenu"><a href="#multiple-response-formats">Multiple Response Formats</a></li>
                <li class="nav-submenu"><a href="#reusable-action-classes">Reusable Action Classes</a></li>
                <li class="nav-submenu"><a href="#openapi-documentation">OpenAPI Documentation</a></li>
                <li class="nav-submenu"><a href="#mount-in-rack-compliant-routers">Mount in Rack-compliant routers</a></li>
                <li class="nav-submenu"><a href="#custom-types">Custom Types</a></li>
                <li class="nav-submenu"><a href="#error-handling">Error Handling</a></li>
                <li class="nav-submenu"><a href="#content-negotiation">Content negotiation</a></li>
                <li class="nav-submenu"><a href="#header-schemas">Header schemas</a></li>
                <li class="nav-submenu"><a href="#security-schemes-authentication-and-authorization">Security Schemes (authentication and authorization)</a></li>
                <li><a href="#installation">Installation</a></li>
                <li><a href="#development">Development</a></li>
                <li><a href="#contributing">Contributing</a></li>
                <li><a href="#license">License</a></li>
            </ul>
        </nav>

        <main class="content">
            <header class="page-header">
                <h1>Steppe</h1>
                <p class="subtitle">Composable, self-documenting REST APIs for Ruby</p>
            </header>

            <section id="overview" class="section">


<p>Steppe is a Ruby gem that provides a DSL for building REST APIs with an emphasis on:</p>

<ul>
  <li>Composability - Built on composable pipelines, allowing endpoints to be assembled from reusable, testable validation and processing<br />
steps</li>
  <li>Type Safety &amp; Validation - Define input schemas for query parameters and request bodies, ensuring data is<br />
validated and coerced before reaching business logic</li>
  <li>Expandable API - start with a terse DSL for defining endpoints, and extend with custom steps as needed.</li>
  <li>Self-Documentation - Automatically generates OpenAPI specifications from endpoint definitions, keeping documentation in sync with<br />
implementation</li>
  <li>Content Negotiation - Handles multiple response formats through a Responder system that matches status codes and content types</li>
  <li>Mountable on Rack routers, and (soon) standalone with its own router.</li>
</ul>

</section>

<section id="usage" class="section">
<h2 id="usage">Usage</h2>

</article>

<article id="defining-a-service" class="subsection">
<h3 id="defining-a-service">Defining a service</h3>

<p>A Service is a container for API endpoints with metadata:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'steppe'</span>

<span class="no">Service</span> <span class="o">=</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Service</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">api</span><span class="o">|</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s1">'Users API'</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'API for managing users'</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">server</span><span class="p">(</span>
    <span class="ss">url: </span><span class="s1">'http://localhost:4567'</span><span class="p">,</span>
    <span class="ss">description: </span><span class="s1">'Production server'</span>
  <span class="p">)</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">tag</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="ss">description: </span><span class="s1">'User management operations'</span><span class="p">)</span>

  <span class="c1"># Define endpoints here...</span>
<span class="k">end</span>
</code></pre></div></div>

</article>

<article id="defining-endpoints" class="subsection">
<h3 id="defining-endpoints">Defining endpoints</h3>

<p>Endpoints define HTTP routes with validation, processing steps, and response serialization:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># GET endpoint with query parameter validation</span>
<span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:users</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'List users'</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">tags</span> <span class="o">=</span> <span class="sx">%w[users]</span>

  <span class="c1"># Validate query parameters</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">query_schema</span><span class="p">(</span>
    <span class="ss">q?: </span><span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'Search by name'</span><span class="p">),</span>
    <span class="ss">limit?: </span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Integer</span><span class="p">.</span><span class="nf">default</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'Number of results'</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="c1"># Business logic step</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="n">users</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">filter_by_name</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:q</span><span class="p">])</span>
                <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:limit</span><span class="p">])</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span> <span class="n">users</span>
  <span class="k">end</span>

  <span class="c1"># JSON response serialization</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:users</span><span class="p">,</span> <span class="p">[</span><span class="no">UserSerializer</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">users</span>
      <span class="n">object</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

</article>

<article id="query-schemas" class="subsection">
<h3 id="query-schemas">Query schemas</h3>

<p>Use <code>#query_schema</code> to register steps to coerce and validate URL path and query parameters.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'List and filter users'</span>
  <span class="c1"># URL path and query parameters will be passed through this schema</span>
  <span class="c1"># You can annotate fields with .desc() and .example() to supplement</span>
  <span class="c1"># the generated OpenAPI specs</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">query_schema</span><span class="p">(</span>
    <span class="ss">q?: </span><span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'full text search'</span><span class="p">).</span><span class="nf">example</span><span class="p">(</span><span class="s1">'bo, media'</span><span class="p">),</span>
    <span class="ss">status?: </span><span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'status filter'</span><span class="p">).</span><span class="nf">options</span><span class="p">(</span><span class="sx">%w[active inactive]</span><span class="p">)</span>
  <span class="p">)</span>
  
  <span class="c1"># coerced and validated parameters are now</span>
  <span class="c1"># available in conn.params</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="n">users</span> <span class="o">=</span> <span class="no">User</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:q</span><span class="p">])</span> <span class="k">if</span> <span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:q</span><span class="p">]</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">by_status</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:status</span><span class="p">])</span> <span class="k">if</span> <span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:status</span><span class="p">]</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span> <span class="n">users</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># GET /users?status=active&amp;q=bob</span>
</code></pre></div></div>

<h4 id="path-parameters">Path parameters</h4>

<p>URL path parameters are automatically extracted and merged into a default query schema:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># the presence of path tokens in path, such as :id</span>
<span class="c1"># will automatically register #query_schema(id: Types::String)</span>
<span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:user</span><span class="p">,</span> <span class="s1">'/users/:id'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'Fetch a user by ID'</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="c1"># conn.params[:id] is a string</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="n">user</span> <span class="p">?</span> <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">:</span> <span class="n">conn</span><span class="p">.</span><span class="nf">invalid</span><span class="p">(</span><span class="ss">errors: </span><span class="p">{</span> <span class="ss">id: </span><span class="s1">'Not found'</span> <span class="p">})</span>
  <span class="k">end</span>

  <span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="mi">200</span><span class="o">...</span><span class="mi">300</span><span class="p">,</span> <span class="no">UserSerializer</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can extend the implicit query schema to add or update individual fields</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Override the implicit :id field </span>
<span class="c1"># to coerce it to an integer</span>
<span class="n">e</span><span class="p">.</span><span class="nf">query_schema</span><span class="p">(</span>
  <span class="ss">id: </span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Integer</span>  
<span class="p">)</span>

<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="c1"># conn.params[:id] is an Integer</span>
  <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span> <span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Multiple calls to <code>#query_schema</code> will aggregate into a single <code>Endpoint#query_schema</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">UsersAPI</span><span class="p">[</span><span class="ss">:user</span><span class="p">].</span><span class="nf">query_schema</span> <span class="c1"># =&gt; Plumb::Types::Hash</span>
</code></pre></div></div>

</article>

<article id="payload-schemas" class="subsection">
<h3 id="payload-schemas">Payload schemas</h3>

<p>Use <code>payload_schema</code> to validate request bodies:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">post</span> <span class="ss">:create_user</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'Create a user'</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">tags</span> <span class="o">=</span> <span class="sx">%w[users]</span>

  <span class="c1"># Validate request body</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">payload_schema</span><span class="p">(</span>
    <span class="ss">user: </span><span class="p">{</span>
      <span class="ss">name: </span><span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'User name'</span><span class="p">).</span><span class="nf">example</span><span class="p">(</span><span class="s1">'Alice'</span><span class="p">),</span>
      <span class="ss">email: </span><span class="no">Types</span><span class="o">::</span><span class="no">Email</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'User email'</span><span class="p">).</span><span class="nf">example</span><span class="p">(</span><span class="s1">'alice@example.com'</span><span class="p">),</span>
      <span class="ss">age: </span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Integer</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'User age'</span><span class="p">).</span><span class="nf">example</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">)</span>

  <span class="c1"># Create user (only runs if payload is valid)</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">])</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">respond_with</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nf">valid</span> <span class="n">user</span>
  <span class="k">end</span>

  <span class="c1"># Serialize response</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="mi">201</span><span class="p">,</span> <span class="no">UserSerializer</span>
<span class="k">end</span>
</code></pre></div></div>

</article>

<article id="its-pipelines-steps-all-the-way-down" class="subsection">
<h3 id="its-pipelines-steps-all-the-way-down">It’s pipelines steps all the way down</h3>

<p>Query and payload schemas are themselves steps in the processing pipeline, so you can insert steps before or after each of them.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Coerce and validate query parameters</span>
<span class="n">e</span><span class="p">.</span><span class="nf">query_schema</span><span class="p">(</span>
  <span class="ss">id: </span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Integer</span><span class="p">.</span><span class="nf">present</span>  
<span class="p">)</span>

<span class="c1"># Use (validated, coerced) ID to locate resource</span>
<span class="c1"># and do some custom authorization</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">if</span> <span class="n">user</span><span class="p">.</span><span class="nf">can_update_account?</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">continue</span> <span class="n">user</span>
  <span class="k">else</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">respond_with</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nf">halt</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Only NOW parse and validate request body</span>
<span class="n">e</span><span class="p">.</span><span class="nf">payload_schema</span><span class="p">(</span>
  <span class="ss">name: </span><span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">present</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'Account name'</span><span class="p">),</span>
  <span class="ss">email: </span><span class="no">Types</span><span class="o">::</span><span class="no">Email</span><span class="p">.</span><span class="nf">presen</span><span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'Account email'</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>A “step” is an <code>#call(Steppe::Result) =&gt; Steppe::Result</code> interface. You can use procs, or you can use your own objects.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FindAndAuthorizeUser</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">conn</span><span class="p">.</span><span class="nf">respond_with</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nf">halt</span> <span class="k">unless</span> <span class="n">user</span><span class="p">.</span><span class="nf">can_update_account?</span>
    
    <span class="n">conn</span><span class="p">.</span><span class="nf">continue</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># In your endpoint</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="no">FindAndAuthorizeUser</span>
</code></pre></div></div>

<p>It’s up to you how/if your custom steps manage their own state (ie. classes vs. instances). You can use instances for configuration, for example.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Works as long as the instance responds to #call(Result) =&gt; Result</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="no">MyCustomAuthorizer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">role: </span><span class="s1">'admin'</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="halting-the-pipeline">Halting the pipeline</h4>

<p>A step that returns a <code>Continue</code> result passes the result on to the next step.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="n">conn</span><span class="p">.</span><span class="nf">continue</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A step that returns a <code>Halt</code> result signals the pipeline to stop processing.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This step halts the pipeline</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="n">conn</span><span class="p">.</span><span class="nf">halt</span>
  <span class="c1"># Or</span>
  <span class="c1"># conn.invalid(errors: {name: 'is invalid'})</span>
<span class="k">end</span>

<span class="c1"># This step will never run</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="c1"># etc</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="steps-with-schemas">Steps with schemas</h4>

<p>A custom step that also supports <code>#query_schema</code>, <code>#payload_schema</code> and <code>#header_schema</code> will have those schemas merged into the endpoint’s schemas, which can be used to generate OpenAPI documentation.</p>

<p>This is so that you’re free to bring your own domain objects that do their own validation.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateUser</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">payload_schema</span> <span class="o">=</span> <span class="no">Types</span><span class="o">::</span><span class="no">Hash</span><span class="p">[</span><span class="ss">name: </span><span class="no">String</span><span class="p">,</span> <span class="ss">age: </span><span class="no">Types</span><span class="o">::</span><span class="no">Integer</span><span class="p">[</span><span class="mi">18</span><span class="o">..</span><span class="p">]]</span>
  
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="c1"># Instantiate, manage state, run your domain logic, etc</span>
    <span class="n">conn</span>
  <span class="k">end</span>
<span class="k">end</span>
  
<span class="c1"># CreateUser.payload_schema will be merged into the endpoint's own payload_schema</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="no">CreateUser</span>

<span class="c1"># You can add fields to the payload schema</span>
<span class="c1"># The top-level endpoint schema will be the merge of both</span>
<span class="n">e</span><span class="p">.</span><span class="nf">payload_schema</span><span class="p">(</span>
  <span class="ss">email: </span><span class="no">Types</span><span class="o">::</span><span class="no">Email</span><span class="p">.</span><span class="nf">present</span>
<span class="p">)</span>
</code></pre></div></div>

</article>

<article id="file-uploads" class="subsection">
<h3 id="file-uploads">File Uploads</h3>

<p>Handle file uploads with the <code>UploadedFile</code> type:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">post</span> <span class="ss">:upload</span><span class="p">,</span> <span class="s1">'/files'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">payload_schema</span><span class="p">(</span>
    <span class="ss">file: </span><span class="no">Steppe</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">UploadedFile</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">type: </span><span class="s1">'text/plain'</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:file</span><span class="p">]</span>
    <span class="c1"># file.tempfile, file.filename, file.type available</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span><span class="p">(</span><span class="n">process_file</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="mi">201</span><span class="p">,</span> <span class="no">FileSerializer</span>
<span class="k">end</span>
</code></pre></div></div>

</article>

<article id="named-serializers" class="subsection">
<h3 id="named-serializers">Named Serializers</h3>

<p>Define reusable serializers:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Serializer</span>
  <span class="n">attribute</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Integer</span><span class="p">.</span><span class="nf">example</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">example</span><span class="p">(</span><span class="s1">'Alice'</span><span class="p">)</span>
  <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Email</span><span class="p">.</span><span class="nf">example</span><span class="p">(</span><span class="s1">'alice@example.com'</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Use in endpoints</span>
<span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="mi">200</span><span class="p">,</span> <span class="no">UserSerializer</span>
</code></pre></div></div>

<p>You can also compose serializers together:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserListSerializer</span> <span class="o">&lt;</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Serializer</span>
  <span class="n">attribute</span> <span class="ss">:page</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Integer</span><span class="p">.</span><span class="nf">example</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">attribute</span> <span class="ss">:users</span><span class="p">,</span> <span class="p">[</span><span class="no">UserSerializer</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">page</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">]</span> <span class="o">||</span> <span class="mi">1</span>
  <span class="k">def</span> <span class="nf">users</span> <span class="o">=</span> <span class="n">object</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Serializers are based on <a href="PostSerializer">Plumb’s Data structs</a>.</p>

</article>

<article id="multiple-response-formats" class="subsection">
<h3 id="multiple-response-formats">Multiple Response Formats</h3>

<p>Support multiple content types:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:user</span><span class="p">,</span> <span class="s1">'/users/:id'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="p">{</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span> <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span><span class="p">(</span><span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]))</span> <span class="p">}</span>

  <span class="c1"># JSON response</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="mi">200</span><span class="p">,</span> <span class="no">UserSerializer</span>

  <span class="c1"># HTML response (using Papercraft)</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">html</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="n">html5</span> <span class="p">{</span>
      <span class="n">body</span> <span class="p">{</span>
        <span class="n">h1</span> <span class="n">conn</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">name</span>
        <span class="nb">p</span> <span class="s2">"Email: </span><span class="si">#{</span><span class="n">conn</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">email</span><span class="si">}</span><span class="s2">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="html-templates">HTML templates</h4>

<p>HTML templates rely on <a href="https://papercraft.noteflakes.com">Papercraft</a>. It’s possible to register your own templating though.</p>

<p>You can pass inline templates like in the example above, or named constants pointing to HTML components.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Somewhere in your app:</span>
<span class="no">UserTemplate</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="n">html5</span> <span class="p">{</span>
    <span class="n">body</span> <span class="p">{</span>
      <span class="n">h1</span> <span class="n">conn</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">name</span>
      <span class="nb">p</span> <span class="s2">"Email: </span><span class="si">#{</span><span class="n">conn</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">email</span><span class="si">}</span><span class="s2">"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># In your endpoint</span>
<span class="n">e</span><span class="p">.</span><span class="nf">html</span><span class="p">(</span><span class="mi">200</span><span class="o">..</span><span class="mi">299</span><span class="p">,</span> <span class="no">UserTemplate</span><span class="p">)</span>
</code></pre></div></div>

<p>See Papercraft’s documentation to learn how to work with <a href="https://papercraft.noteflakes.com/docs/03-template-composition/02-working-with-layouts">layouts</a>, nested <a href="https://papercraft.noteflakes.com/docs/03-template-composition/01-component-templates">components</a>, and more.</p>

</article>

<article id="reusable-action-classes" class="subsection">
<h3 id="reusable-action-classes">Reusable Action Classes</h3>

<p>Encapsulate logic in action classes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UpdateUser</span>
  <span class="no">SCHEMA</span> <span class="o">=</span> <span class="no">Types</span><span class="o">::</span><span class="no">Hash</span><span class="p">[</span>
    <span class="ss">name: </span><span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">present</span><span class="p">,</span>
    <span class="ss">age: </span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Integer</span><span class="p">[</span><span class="mi">18</span><span class="o">..</span><span class="p">]</span>
  <span class="p">]</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">payload_schema</span> <span class="o">=</span> <span class="no">SCHEMA</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">],</span> <span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">)</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span> <span class="n">user</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Use in endpoint</span>
<span class="n">api</span><span class="p">.</span><span class="nf">put</span> <span class="ss">:update_user</span><span class="p">,</span> <span class="s1">'/users/:id'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="no">UpdateUser</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="mi">200</span><span class="p">,</span> <span class="no">UserSerializer</span>
<span class="k">end</span>
</code></pre></div></div>

</article>

<article id="openapi-documentation" class="subsection">
<h3 id="openapi-documentation">OpenAPI Documentation</h3>

<p>Use a service’s <code>#specs</code> helper to mount a GET route to automatically serve OpenAPI schemas from.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">MyAPI</span> <span class="o">=</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Service</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">api</span><span class="o">|</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s1">'Users API'</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'API for managing users'</span>
  
  <span class="c1"># OpenAPI JSON schemas for this service</span>
  <span class="c1"># will be available at GET /schemas (defaults to /)</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">specs</span><span class="p">(</span><span class="s1">'/schemas'</span><span class="p">)</span>
  
  <span class="c1"># Define API endpoints</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="c1"># etc</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Or use the <code>OpenAPIVisitor</code> directly</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get OpenAPI JSON</span>
<span class="n">openapi_spec</span> <span class="o">=</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">OpenAPIVisitor</span><span class="p">.</span><span class="nf">from_request</span><span class="p">(</span><span class="no">MyAPI</span><span class="p">,</span> <span class="n">rack_request</span><span class="p">)</span>

<span class="c1"># Or generate manually</span>
<span class="n">openapi_spec</span> <span class="o">=</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">OpenAPIVisitor</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="no">MyAPI</span><span class="p">)</span>
</code></pre></div></div>

<p><img width="831" height="855" alt="CleanShot 2025-10-06 at 18 04 55" src="https://github.com/user-attachments/assets/fea61225-538b-4653-bdd0-9f8b21c8c389" /><br />
Using the <a href="https://swagger.io/tools/swagger-ui/">Swagger UI</a> tool to view a Steppe API definition.</p>

</article>

<article id="mount-in-rack-compliant-routers" class="subsection">
<h3 id="mount-in-rack-compliant-routers">Mount in Rack-compliant routers</h3>

<h4 id="sinatra">Sinatra</h4>

<p>Mount Steppe services in a Sinatra app:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="no">MyService</span><span class="p">.</span><span class="nf">endpoints</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">endpoint</span><span class="o">|</span>
    <span class="n">public_send</span><span class="p">(</span><span class="n">endpoint</span><span class="p">.</span><span class="nf">verb</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">.</span><span class="nf">path</span><span class="p">.</span><span class="nf">to_templates</span><span class="p">.</span><span class="nf">first</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">resp</span> <span class="o">=</span> <span class="n">endpoint</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="nf">response</span>
      <span class="n">resp</span><span class="p">.</span><span class="nf">finish</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="hanamirouter"><code>Hanami::Router</code></h4>

<p>The excellent and fast <a href="">Hanami::Router</a> can be used as a standalone router for Steppe services. Or you can mount them into an existing Hanami app.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># hanami_service.ru</span>
<span class="c1"># run with</span>
<span class="c1">#   bundle exec rackup ./hanami_service.ru</span>
<span class="nb">require</span> <span class="s1">'hanami/router'</span>
<span class="nb">require</span> <span class="s1">'rack/cors'</span>

<span class="n">app</span> <span class="o">=</span> <span class="no">MyService</span><span class="p">.</span><span class="nf">route_with</span><span class="p">(</span><span class="no">Hanami</span><span class="o">::</span><span class="no">Router</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>

<span class="c1"># Or mount within a router block</span>
<span class="n">app</span> <span class="o">=</span> <span class="no">Hanami</span><span class="o">::</span><span class="no">Router</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
  <span class="n">scope</span> <span class="s1">'/api'</span> <span class="k">do</span>
    <span class="no">MyService</span><span class="p">.</span><span class="nf">route_with</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Allowing all origins</span>
<span class="c1"># to make Swagger UI work</span>
<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Cors</span> <span class="k">do</span>
  <span class="n">allow</span> <span class="k">do</span>
    <span class="n">origins</span> <span class="s1">'*'</span>
    <span class="n">resource</span> <span class="s1">'*'</span><span class="p">,</span> <span class="ss">headers: :any</span><span class="p">,</span> <span class="ss">methods: :any</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">run</span> <span class="n">app</span>
</code></pre></div></div>

<p>See <code>examples/hanami.ru</code></p>

</article>

<article id="custom-types" class="subsection">
<h3 id="custom-types">Custom Types</h3>

<p>Define custom validation types using <a href="https://github.com/ismasan/plumb">Plumb</a>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">Types</span>
  <span class="kp">include</span> <span class="no">Plumb</span><span class="o">::</span><span class="no">Types</span>

  <span class="no">UserCategory</span> <span class="o">=</span> <span class="no">String</span>
    <span class="p">.</span><span class="nf">options</span><span class="p">(</span><span class="sx">%w[admin customer guest]</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">default</span><span class="p">(</span><span class="s1">'guest'</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">desc</span><span class="p">(</span><span class="s1">'User category'</span><span class="p">)</span>

  <span class="no">DowncaseString</span> <span class="o">=</span> <span class="no">String</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="ss">:downcase</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Use in schemas</span>
<span class="n">e</span><span class="p">.</span><span class="nf">query_schema</span><span class="p">(</span>
  <span class="ss">category?: </span><span class="no">Types</span><span class="o">::</span><span class="no">UserCategory</span>
<span class="p">)</span>
</code></pre></div></div>

</article>

<article id="error-handling" class="subsection">
<h3 id="error-handling">Error Handling</h3>

<p>Endpoints automatically handle validation errors with 422 responses. Customize error responses:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">e</span><span class="p">.</span><span class="nf">json</span> <span class="mi">422</span> <span class="k">do</span>
  <span class="n">attribute</span> <span class="ss">:errors</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Hash</span>

  <span class="k">def</span> <span class="nf">errors</span>
    <span class="n">object</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

</article>

<article id="content-negotiation" class="subsection">
<h3 id="content-negotiation">Content negotiation</h3>

<p>The <code>#json</code> and <code>#html</code> Endpoint methods are shortcuts for <code>Responder</code> objects that can be tailored to specific combinations of request accepted content types, and response status.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># equivalent to e.json(200, UserSerializer)</span>
<span class="n">e</span><span class="p">.</span><span class="nf">respond</span> <span class="mi">200</span><span class="p">,</span> <span class="ss">:json</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
  <span class="n">r</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s2">"JSON response"</span>
  <span class="n">r</span><span class="p">.</span><span class="nf">serialize</span> <span class="no">UserSerializer</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Responders switch their serializer type depending on their resulting content type.</p>

<p>This is a responder that accepts HTML requests, and responds with JSON.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">e</span><span class="p">.</span><span class="nf">respond</span> <span class="ss">statuses: </span><span class="mi">200</span><span class="o">..</span><span class="mi">299</span><span class="p">,</span> <span class="ss">accepts: :html</span><span class="p">,</span> <span class="ss">content_type: :json</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
  <span class="c1"># Using an inline JSON serializer this time</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">serialize</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>
    <span class="n">attribute</span> <span class="ss">:age</span><span class="p">,</span> <span class="no">Integer</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Responders can accept wildcard media types, and an endpoint can define multiple responders, from more to less specific.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">e</span><span class="p">.</span><span class="nf">respond</span> <span class="mi">200</span><span class="p">,</span> <span class="ss">:json</span><span class="p">,</span> <span class="no">UserSerializer</span>
<span class="n">e</span><span class="p">.</span><span class="nf">respond</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">'text/*'</span><span class="p">,</span> <span class="no">UserTextSerializer</span>
</code></pre></div></div>

</article>

<article id="header-schemas" class="subsection">
<h3 id="header-schemas">Header schemas</h3>

<p><code>Endpoint#header_schema</code> is similar to <code>#query_schema</code> and <code>#payload_schema</code>, and it allows to define schemas to validate and/or coerce request headers.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="c1"># Coerce some expected request headers</span>
  <span class="c1"># This coerces the APIVersion header to a number</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">header_schema</span><span class="p">(</span>
    <span class="s1">'APIVersion'</span> <span class="o">=&gt;</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Numeric</span>
  <span class="p">)</span>
  
  <span class="c1"># Downstream handlers will get a numeric header value</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
    <span class="no">Logger</span><span class="p">.</span><span class="nf">info</span> <span class="n">conn</span><span class="p">.</span><span class="nf">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s1">'APIVersion'</span><span class="p">]</span> <span class="c1"># a number</span>
    <span class="n">conn</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>These header schemas are inclusive: they don’t remove other headers not included in the schemas.</p>

<p>They also generate OpenAPI docs.</p>

<p><img width="850" height="595" alt="CleanShot 2025-10-11 at 23 59 05" src="https://github.com/user-attachments/assets/c25e65f7-8733-42d9-a1b6-b93d815e2981" /></p>

<h4 id="header-schema-order-matters">Header schema order matters</h4>

<p>Like most things in Steppe, query schemas are registered as steps in a pipeline, so the order of registration matters.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># No header schema coercion yet, the header is a string here.</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="no">Logger</span><span class="p">.</span><span class="nf">info</span> <span class="n">conn</span><span class="p">.</span><span class="nf">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s1">'APIVersion'</span><span class="p">]</span> <span class="c1"># a STRING</span>
  <span class="n">conn</span>
<span class="k">end</span>

<span class="c1"># Register the schema as a step in the endpoint's pipeline</span>
<span class="n">e</span><span class="p">.</span><span class="nf">header_schema</span><span class="p">(</span>
    <span class="s1">'APIVersion'</span> <span class="o">=&gt;</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Numeric</span>
<span class="p">)</span>

<span class="c1"># By the time this new step runs</span>
<span class="c1"># the header schema above has coerced the headers</span>
<span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="k">do</span> <span class="o">|</span><span class="n">conn</span><span class="o">|</span>
  <span class="no">Logger</span><span class="p">.</span><span class="nf">info</span> <span class="n">conn</span><span class="p">.</span><span class="nf">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s1">'APIVersion'</span><span class="p">]</span> <span class="c1"># a NUMBER</span>
  <span class="n">conn</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="multiple-header-schemas">Multiple header schemas</h4>

<p>Like with <code>#query_schema</code> and <code>#payload_schema</code>, <code>#header_schema</code> can be invoked multiple times, which will register individual validation steps, but it will also merge those schemas into the top-level <code>Endpoint#header_schema</code>, which goes into OpenAPI docs.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">header_schema</span><span class="p">(</span><span class="s1">'ApiVersion'</span> <span class="o">=&gt;</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Numeric</span><span class="p">)</span>
  <span class="c1"># some more steps</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">step</span> <span class="no">SomeHandler</span>
  <span class="c1"># add to endpoint's header schema</span>
  <span class="n">e</span><span class="p">.</span><span class="nf">header_schema</span><span class="p">(</span><span class="s1">'HTTP_AUTHORIZATION'</span> <span class="o">=&gt;</span> <span class="no">JWTParser</span><span class="p">)</span>
  <span class="c1"># more steps ...</span>
<span class="k">end</span>

<span class="c1"># Endpoint's header_schema includes all fields</span>
<span class="no">UserAPI</span><span class="p">[</span><span class="ss">:list_users</span><span class="p">].</span><span class="nf">header_schema</span>
<span class="c1"># is a </span>
<span class="no">Steppe</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">Hash</span><span class="p">[</span>
   <span class="s1">'ApiVersion'</span> <span class="o">=&gt;</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">Lax</span><span class="o">::</span><span class="no">Numeric</span><span class="p">,</span>
   <span class="s1">'HTTP_AUTHORISATION'</span> <span class="o">=&gt;</span> <span class="no">JWTParser</span>
<span class="p">]</span>
</code></pre></div></div>

<h4 id="header-schema-composition">Header schema composition</h4>

<p>Custom steps that define their own <code>#header_schema</code> will also have their schemas merged into the endpoint’s <code>#header_schema</code>, and automatically documented in OpenAPI.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ListUsersAction</span>
  <span class="no">HEADER_SCHEMA</span> <span class="o">=</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">Hash</span><span class="p">[</span><span class="s1">'ClientVersion'</span> <span class="o">=&gt;</span> <span class="no">String</span><span class="p">]</span>
  
  <span class="c1"># responding to this method will cause</span>
  <span class="c1"># Steppe to merge this schema into the endpoint's</span>
  <span class="k">def</span> <span class="nf">header_schema</span> <span class="o">=</span> <span class="no">HEADER_SCHEMA</span>
  
  <span class="c1"># The Step interface to handle requests</span>
  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="no">Logger</span><span class="p">.</span><span class="nf">info</span> <span class="n">conn</span><span class="p">.</span><span class="nf">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s1">'ClientVersion'</span><span class="p">]</span>
    <span class="c1"># do something</span>
    <span class="n">users</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">page</span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="nf">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">])</span>
    <span class="n">conn</span><span class="p">.</span><span class="nf">valid</span> <span class="n">users</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Note that this also applies to Security Schemes above. For example, the built-in <code>Steppe::Auth::Bearer</code> scheme defines a header schema to declare the <code>Authorization</code> header.</p>

</article>

<article id="security-schemes-authentication-and-authorization" class="subsection">
<h3 id="security-schemes-authentication-and-authorization">Security Schemes (authentication and authorization)</h3>

<p>Steppe follows the same design as <a href="https://swagger.io/docs/specification/v3_0/authentication/">OpenAPI security schemes</a>.</p>

<p>A service defines one or more security schemes, which can then be opted-in either by individual endpoints, or for all endpoints at once.</p>

<p>Steppe provides two built-in schemes: <strong>Bearer token</strong> authentication (with scopes) and <strong>Basic</strong> HTTP authentication. More coming later.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">UsersAPI</span> <span class="o">=</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Service</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">api</span><span class="o">|</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s1">'Users API'</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'API for managing users'</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">server</span><span class="p">(</span>
    <span class="ss">url: </span><span class="s1">'http://localhost:9292'</span><span class="p">,</span>
    <span class="ss">description: </span><span class="s1">'local server'</span>
  <span class="p">)</span>

  <span class="c1"># Bearer token authentication with scopes</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">bearer_auth</span><span class="p">(</span>
    <span class="s1">'BearerToken'</span><span class="p">,</span>
    <span class="ss">store: </span><span class="p">{</span>
      <span class="s1">'admintoken'</span> <span class="o">=&gt;</span> <span class="sx">%w[users:read users:write]</span><span class="p">,</span>
      <span class="s1">'publictoken'</span> <span class="o">=&gt;</span> <span class="sx">%w[users:read]</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">)</span>

  <span class="c1"># Basic HTTP authentication (username/password)</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">basic_auth</span><span class="p">(</span>
    <span class="s1">'BasicAuth'</span><span class="p">,</span>
    <span class="ss">store: </span><span class="p">{</span>
      <span class="s1">'admin'</span> <span class="o">=&gt;</span> <span class="s1">'secret123'</span><span class="p">,</span>
      <span class="s1">'user'</span> <span class="o">=&gt;</span> <span class="s1">'password456'</span>
    <span class="p">}</span>
  <span class="p">)</span>

  <span class="c1"># Endpoint definitions here</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="c1"># etc</span>
  <span class="k">end</span>

  <span class="n">api</span><span class="p">.</span><span class="nf">post</span> <span class="ss">:create_user</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="c1"># etc</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="1a-per-endpoint-security">1.a Per-endpoint security</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># Each endpoint can opt-in to using registered security schemes</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'List users'</span>

    <span class="c1"># Bearer auth with scopes</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">security</span> <span class="s1">'BearerToken'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'users:read'</span><span class="p">]</span>
    <span class="c1"># etc</span>
  <span class="k">end</span>

  <span class="n">api</span><span class="p">.</span><span class="nf">post</span> <span class="ss">:create_user</span><span class="p">,</span> <span class="s1">'/users'</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="s1">'Create user'</span>

    <span class="c1"># Basic auth (no scopes)</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">security</span> <span class="s1">'BasicAuth'</span>
    <span class="c1"># etc</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>A request without the Authorization header responds with 401</p>

<pre><code>curl -i http://localhost:9292/users

HTTP/1.1 401 Unauthorized
content-type: application/json
vary: Origin
content-length: 47

{"http":{"status":401},"params":{},"errors":{}}
</code></pre>

<p>A request with the wrong access token responds with 403</p>

<pre><code>curl -i -H "Authorization: Bearer nope" http://localhost:9292/users

HTTP/1.1 401 Unauthorized
content-type: application/json
vary: Origin
content-length: 47

{"http":{"status":401},"params":{},"errors":{}}
</code></pre>

<p>A response with valid token succeeds</p>

<pre><code>curl -i -H "Authorization: Bearer publictoken" http://localhost:9292/users

HTTP/1.1 200 OK
content-type: application/json
vary: Origin
content-length: 262

{"users":[{"id":1,"name":"Alice","age":30,"email":"alice@server.com","address":"123 Great St"},{"id":2,"name":"Bob","age":25,"email":"bob@server.com","address":"23 Long Ave."},{"id":3,"name":"Bill","age":20,"email":"bill@server.com","address":"Bill's Mansion"}]}
</code></pre>

<h4 id="1b-service-level-security">1.b. Service-level security</h4>

<p>Using the <code>#security</code> method at the service level registers that scheme for all endpoints defined after that</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">UsersAPI</span> <span class="o">=</span> <span class="no">Steppe</span><span class="o">::</span><span class="no">Service</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">api</span><span class="o">|</span>
  <span class="c1"># etc</span>
  <span class="c1"># Define the security scheme</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">bearer_auth</span><span class="p">(</span><span class="s1">'BearerToken'</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

  <span class="c1"># Now apply the scheme to all endpoints in this service, with the same scopes</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">security</span> <span class="s1">'BearerToken'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'users:read'</span><span class="p">]</span>

  <span class="c1"># all endpoints here enforce a bearer token with scope 'users:read'</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span>
  <span class="n">api</span><span class="p">.</span><span class="nf">post</span> <span class="ss">:create_user</span><span class="p">,</span> <span class="s1">'/users'</span>
  <span class="c1"># etc</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Note that the order of the <code>security</code> invocation matters. <br />
The following example defines an un-authenticated <code>:root</code> endpoint, and then protects all further endpoints with the ‘BearerToken` scheme.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:root</span><span class="p">,</span> <span class="s1">'/'</span> <span class="c1"># &lt;= public endpoint</span>

<span class="n">api</span><span class="p">.</span><span class="nf">security</span> <span class="s1">'BearerToken'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'users:read'</span><span class="p">]</span> <span class="c1"># &lt;= applies to all endpoints after this</span>

<span class="n">api</span><span class="p">.</span><span class="nf">get</span> <span class="ss">:list_users</span><span class="p">,</span> <span class="s1">'/users'</span>
<span class="n">api</span><span class="p">.</span><span class="nf">post</span> <span class="ss">:create_user</span><span class="p">,</span> <span class="s1">'/users'</span>
</code></pre></div></div>

<h4 id="automatic-openapi-docs">Automatic OpenAPI docs</h4>

<p>The OpenAPI endpoint mounted via <code>api.specs('/openapi.json')</code> will include these security schemas.<br />
This is how that shows in the <a href="https://swagger.io/tools/swagger-ui/">SwaggerUI</a> tool.</p>

<p><img width="922" height="812" alt="CleanShot 2025-10-11 at 23 46 02" src="https://github.com/user-attachments/assets/3bdecb81-8248-4437-a78a-c80dd7d44ebd" /></p>

<h4 id="custom-bearer-token-store-or-basic-credential-stores">Custom bearer token store or basic credential stores</h4>

<p>See the comments and interfaces in <code>lib/steppe/auth/*</code> to learn how to provide custom credential stores to the built-in security schemes. For example to store and fetch credentials from a database or file.</p>

<p>As an example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">bearer_auth</span> <span class="s1">'BearerToken'</span><span class="p">,</span> <span class="ss">store: </span><span class="no">RedisTokenStore</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">REDIS</span><span class="p">)</span>
</code></pre></div></div>

<p>You can also implement stores to fetch tokens from a database, or to decode JWT tokens with a secret, etc.</p>

<h4 id="custom-security-schemes">Custom security schemes</h4>

<p><code>Service#bearer_auth</code> and <code>#basic_auth</code> are shortcuts to register built-in security schemes. You can use <code>Service#security_scheme</code> to register custom implementations.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">api</span><span class="p">.</span><span class="nf">security_scheme</span> <span class="no">MyCustomAuthentication</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s1">'BulletProof'</span><span class="p">)</span>
</code></pre></div></div>

<p>The custom security scheme is expected to implement the following interface:</p>

<pre><code>#name() =&gt; String
#handle(Steppe::Result, endpoint_expected_scopes) =&gt; Steppe::Result
#to_openapi() =&gt; Hash
</code></pre>

<p>An example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyCustomAuthentication</span>
  <span class="no">HEADER_NAME</span> <span class="o">=</span> <span class="s1">'X-API-Key'</span>
  
  <span class="nb">attr_reader</span> <span class="ss">:name</span>
  
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">:)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
  
   <span class="c1"># @param conn [Steppe::Result::Continue]</span>
   <span class="c1"># @param endpoint_scopes [Array&lt;String&gt;] scopes expected by this endpoint (if any)</span>
   <span class="c1"># @return [Steppe::Result::Continue, Steppe::Result::Halt]</span>
  <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_endpoint_scopes</span><span class="p">)</span>
     <span class="n">api_token</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="no">HEADER_NAME</span><span class="p">]</span>
     <span class="k">return</span> <span class="n">conn</span><span class="p">.</span><span class="nf">respond_with</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nf">halt</span> <span class="k">if</span> <span class="n">api_token</span><span class="p">.</span><span class="nf">nil?</span>
     
     <span class="k">return</span> <span class="n">conn</span><span class="p">.</span><span class="nf">respond_with</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">halt</span> <span class="k">if</span> <span class="n">api_token</span> <span class="o">!=</span> <span class="s1">'super-secure-token'</span>
     
     <span class="c1"># all good, continue handling the request</span>
     <span class="n">conn</span>
  <span class="k">end</span>
  
  <span class="c1"># This data will be included in the OpenAPI specification</span>
  <span class="c1"># for this security scheme</span>
  <span class="c1"># @see https://swagger.io/docs/specification/v3_0/authentication/</span>
  <span class="c1"># @return [Hash]</span>
  <span class="k">def</span> <span class="nf">to_openapi</span>
    <span class="p">{</span>
      <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'apiKey'</span><span class="p">,</span>
      <span class="s1">'in'</span> <span class="o">=&gt;</span> <span class="s1">'header'</span><span class="p">,</span>
      <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="no">HEADER_NAME</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Security schemes can optionally implement <a href="#query-schemas">#query_schema</a>, <a href="#payload-schemas">#payload_schemas</a> and <a href="#header-schemas">#header_schema</a>, which will be merged onto the endpoint’s equivalents, and automatically added to OpenAPI documentation.</p>

<section id="installation" class="section">
<h2 id="installation">Installation</h2>

<p>TODO: Replace <code>UPDATE_WITH_YOUR_GEM_NAME_IMMEDIATELY_AFTER_RELEASE_TO_RUBYGEMS_ORG</code> with your gem name right after releasing it to RubyGems.org. Please do not do it earlier due to security reasons. Alternatively, replace this section with instructions to install your gem from git if you don’t plan to release to RubyGems.org.</p>

<p>Install the gem and add to the application’s Gemfile by executing:</p>

<pre><code>$ bundle add UPDATE_WITH_YOUR_GEM_NAME_IMMEDIATELY_AFTER_RELEASE_TO_RUBYGEMS_ORG
</code></pre>

<p>If bundler is not being used to manage dependencies, install the gem by executing:</p>

<pre><code>$ gem install UPDATE_WITH_YOUR_GEM_NAME_IMMEDIATELY_AFTER_RELEASE_TO_RUBYGEMS_ORG
</code></pre>

<section id="development" class="section">
<h2 id="development">Development</h2>

<p>After checking out the repo, run <code>bin/setup</code> to install dependencies. Then, run <code>rake spec</code> to run the tests. You can also run <code>bin/console</code> for an interactive prompt that will allow you to experiment.</p>

<p>To install this gem onto your local machine, run <code>bundle exec rake install</code>. To release a new version, update the version number in <code>version.rb</code>, and then run <code>bundle exec rake release</code>, which will create a git tag for the version, push git commits and the created tag, and push the <code>.gem</code> file to <a href="https://rubygems.org">rubygems.org</a>.</p>

<section id="contributing" class="section">
<h2 id="contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at https://github.com/[USERNAME]/steppe.</p>

<section id="license" class="section">
<h2 id="license">License</h2>

<p>The gem is available as open source under the terms of the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>

</article>
</section>
        </main>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/ruby.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
        // Active section highlighting
        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -60% 0px',
            threshold: 0
        };

        const sections = document.querySelectorAll('section, article[id]');
        const navLinks = document.querySelectorAll('.nav-menu a');

        // Create a map of href to link elements
        const linkMap = new Map();
        navLinks.forEach(link => {
            const href = link.getAttribute('href');
            if (href && href.startsWith('#')) {
                linkMap.set(href, link);
            }
        });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    const activeLink = linkMap.get(`#${id}`);

                    if (activeLink) {
                        // Remove active class from all links
                        navLinks.forEach(link => link.classList.remove('active'));
                        // Add active class to current link
                        activeLink.classList.add('active');

                        // Update URL hash without scrolling
                        if (history.replaceState) {
                            history.replaceState(null, null, `#${id}`);
                        } else {
                            window.location.hash = id;
                        }
                    }
                }
            });
        }, observerOptions);

        // Observe all sections
        sections.forEach(section => {
            if (section.id) {
                observer.observe(section);
            }
        });
    </script>
</body>
</html>
